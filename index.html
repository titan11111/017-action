<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
  <title>üåÜ „Çµ„Ç§„Éê„Éº„Éë„É≥„ÇØ„Éª„Éç„Ç™„Ç∑„ÉÜ„Ç£„Éª„Ç¢„ÇØ„Ç∑„Éß„É≥</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --neon-cyan: #00ffff;
      --neon-pink: #ff00ff;
      --neon-yellow: #ffff00;
      --dark-bg: #0a0a0f;
      --cyber-dark: #1a1a2e;
      --cyber-blue: #0f3460;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 100%);
      overflow: hidden;
      font-family: 'Orbitron', monospace;
      color: #eee;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    .cyber-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      pointer-events: none;
    }

    .cyber-grid {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image:
        linear-gradient(to right, rgba(0, 255, 255, 0.1) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(0, 255, 255, 0.1) 1px, transparent 1px);
      background-size: 50px 50px;
      opacity: 0.3;
      animation: gridFlow 30s linear infinite;
    }

    @keyframes gridFlow {
      from { transform: translate(0, 0); }
      to { transform: translate(50px, 50px); }
    }

    #gameContainer {
      position: relative;
      width: 800px;
      height: 600px;
      overflow: hidden;
      border: 3px solid var(--neon-cyan);
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
      background-color: var(--cyber-dark);
    }

    #gameCanvas {
      display: block;
      width: 100%;
      height: 100%;
      background: linear-gradient(to bottom, #0a0a1a, #000);
    }

    #gameInfo {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background: rgba(0, 0, 0, 0.7);
      border-bottom: 2px solid var(--neon-cyan);
      z-index: 5;
      font-size: 14px;
      color: var(--neon-cyan);
      font-weight: bold;
    }

    .info-item {
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(0, 255, 255, 0.1);
      padding: 5px 15px;
      border-radius: 20px;
      border: 1px solid var(--neon-cyan);
    }

    .info-value {
      color: var(--neon-yellow);
      font-size: 18px;
      text-shadow: 0 0 10px var(--neon-yellow);
    }

    #soundControls {
      display: flex;
      gap: 5px;
    }

    .sound-btn {
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid var(--neon-cyan);
      border-radius: 5px;
      color: var(--neon-cyan);
      padding: 5px 10px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .sound-btn:hover {
      background: rgba(0, 255, 255, 0.2);
    }

    .sound-btn.muted {
      opacity: 0.5;
      border-color: #666;
      color: #666;
    }

    #mobileControls {
      display: none;
    }

    .control-btn {
      background: linear-gradient(135deg, var(--cyber-blue), var(--cyber-dark));
      border: 3px solid var(--neon-cyan);
      border-radius: 50%;
      color: var(--neon-cyan);
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      touch-action: manipulation;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.6), inset 0 2px 10px rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.1s;
      text-shadow: 0 0 10px var(--neon-cyan);
    }

    .control-btn:active {
      transform: scale(0.92);
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.9), inset 0 2px 15px rgba(255, 255, 255, 0.2);
      background: linear-gradient(135deg, var(--neon-cyan), var(--cyber-blue));
    }

    .jump-btn {
      background: linear-gradient(135deg, #660066, var(--cyber-dark));
      border-color: var(--neon-pink);
      color: var(--neon-pink);
      box-shadow: 0 0 20px rgba(255, 0, 255, 0.6), inset 0 2px 10px rgba(255, 255, 255, 0.1);
      text-shadow: 0 0 10px var(--neon-pink);
    }

    .jump-btn:active {
      box-shadow: 0 0 30px rgba(255, 0, 255, 0.9), inset 0 2px 15px rgba(255, 255, 255, 0.2);
      background: linear-gradient(135deg, var(--neon-pink), #660066);
    }

    #messageScreen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 20;
      padding: 20px;
    }

    .message-content {
      background: var(--cyber-dark);
      border: 3px solid var(--neon-pink);
      box-shadow: 0 0 30px rgba(255, 0, 255, 0.7);
      padding: 30px;
      border-radius: 10px;
      width: 90%;
      max-width: 500px;
      text-align: center;
    }

    #messageTitle {
      font-size: 24px;
      margin-bottom: 20px;
      color: var(--neon-cyan);
      text-shadow: 0 0 10px var(--neon-cyan);
    }

    #messageText {
      margin-bottom: 30px;
      color: #eee;
      line-height: 1.6;
      font-size: 14px;
    }

    .start-btn {
      background: var(--cyber-blue);
      color: #fff;
      border: 2px solid var(--neon-cyan);
      border-radius: 8px;
      padding: 12px 30px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 5px 15px rgba(0, 255, 255, 0.4);
      font-family: 'Orbitron', monospace;
    }

    .start-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 255, 255, 0.6);
    }

    @media (max-width: 768px) {
      #gameContainer {
        width: 100vw;
        height: 100vh;
        border: none;
        border-radius: 0;
      }

      #gameInfo {
        font-size: 10px;
        padding: 5px 10px;
        flex-wrap: wrap;
        gap: 5px;
      }

      .info-item {
        padding: 3px 8px;
        font-size: 9px;
      }

      .info-value {
        font-size: 12px;
      }

      #soundControls {
        gap: 3px;
      }

      .sound-btn {
        padding: 3px 6px;
        font-size: 12px;
      }

      #mobileControls {
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 10;
        pointer-events: none;
      }

      #leftBtn, #rightBtn {
        position: absolute;
        bottom: 25px;
        width: 75px;
        height: 75px;
        pointer-events: auto;
      }

      #leftBtn { left: 20px; }
      #rightBtn { left: 110px; }

      #jumpBtn {
        position: absolute;
        bottom: 25px;
        right: 20px;
        width: 100px;
        height: 100px;
        pointer-events: auto;
        font-size: 32px;
      }
    }

    @media (max-width: 768px) and (orientation: landscape) {
      #gameInfo { padding: 3px 8px; }
      .info-item { padding: 2px 6px; font-size: 8px; }
      .info-value { font-size: 10px; }

      #leftBtn, #rightBtn {
        bottom: 15px;
        width: 60px;
        height: 60px;
        font-size: 22px;
      }
      #leftBtn { left: 15px; }
      #rightBtn { left: 85px; }
      #jumpBtn {
        bottom: 15px;
        right: 15px;
        width: 80px;
        height: 80px;
        font-size: 26px;
      }
    }

    @media (max-width: 414px) {
      #leftBtn, #rightBtn {
        width: 65px;
        height: 65px;
        font-size: 24px;
      }
      #leftBtn { left: 15px; }
      #rightBtn { left: 90px; }
      #jumpBtn {
        width: 85px;
        height: 85px;
        font-size: 28px;
      }
    }
  </style>
</head>
<body>
  <div class="cyber-bg">
    <div class="cyber-grid"></div>
  </div>

  <div id="gameContainer">
    <div id="gameInfo">
      <div class="info-item">
        <span>STAGE</span>
        <span id="currentStage" class="info-value">1</span>
      </div>
      <div class="info-item">
        <span>LIFE</span>
        <span id="currentLife" class="info-value">3</span>
      </div>
      <div class="info-item">
        <span>SCORE</span>
        <span id="currentScore" class="info-value">0</span>
      </div>
      <div id="soundControls">
        <button id="bgmToggle" class="sound-btn" title="BGM">üéµ</button>
        <button id="seToggle" class="sound-btn" title="ÂäπÊûúÈü≥">üîä</button>
      </div>
    </div>

    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <div id="mobileControls">
      <button id="leftBtn" class="control-btn">‚óÄ</button>
      <button id="rightBtn" class="control-btn">‚ñ∂</button>
      <button id="jumpBtn" class="control-btn jump-btn">‚ñ≤</button>
    </div>

    <div id="messageScreen">
      <div class="message-content">
        <h2 id="messageTitle">CYBER CITY ADVENTURE</h2>
        <p id="messageText">„Çµ„Ç§„Éê„Éº„Éë„É≥„ÇØ„ÅÆ‰∏ñÁïå„ÇíÂÜíÈô∫„Åó„Çà„ÅÜÔºÅ<br>10„Çπ„ÉÜ„Éº„Ç∏ÂÖ®„ÇØ„É™„Ç¢„ÇíÁõÆÊåá„ÅõÔºÅ</p>
        <button id="messageButton" class="start-btn">START GAME</button>
      </div>
    </div>
  </div>

  <script>
    // ===== „Ç™„Éº„Éá„Ç£„Ç™„Ç∑„Çπ„ÉÜ„É†ÔºàiOSÂØæÂøú„ÉªÂ§âÊõ¥„Å™„ÅóÔºâ =====
    const AudioSystem = {
      bgm: null,
      bgmBoss: null,
      currentBGM: null,
      bgmEnabled: true,
      seEnabled: true,
      volume: 0.5,
      audioContext: null,
      initialized: false,

      init: function() {
        if (this.initialized) return;
        this.bgm = new Audio('audio/Neon Circuitry.mp3');
        this.bgm.loop = true;
        this.bgm.volume = this.volume;
        this.bgmBoss = new Audio('audio/tobu.mp3');
        this.bgmBoss.loop = true;
        this.bgmBoss.volume = this.volume;
        this.initialized = true;
      },

      playBGM: function(isBoss = false) {
        if (!this.bgmEnabled) return;
        this.stopBGM();
        this.currentBGM = isBoss ? this.bgmBoss : this.bgm;
        if (this.currentBGM) {
          this.currentBGM.currentTime = 0;
          this.currentBGM.volume = this.volume;
          this.currentBGM.play().catch(e => console.log('BGMÂÜçÁîüÂæÖÊ©ü‰∏≠'));
        }
      },

      stopBGM: function() {
        if (this.currentBGM) {
          this.currentBGM.pause();
          this.currentBGM.currentTime = 0;
        }
      },

      pauseBGM: function() {
        if (this.currentBGM) this.currentBGM.pause();
      },

      resumeBGM: function() {
        if (this.bgmEnabled && this.currentBGM) {
          this.currentBGM.play().catch(e => {});
        }
      },

      playSE: function(type) {
        if (!this.seEnabled) return;
        if (!this.audioContext) {
          this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
        const ctx = this.audioContext;
        const now = ctx.currentTime;

        switch(type) {
          case 'jump':
            this.playTone(ctx, 400, 0.1, 'square', now, 600);
            break;
          case 'coin':
            this.playTone(ctx, 800, 0.1, 'square', now);
            this.playTone(ctx, 1000, 0.1, 'square', now + 0.1);
            break;
          case 'heart':
            this.playTone(ctx, 600, 0.15, 'sine', now);
            this.playTone(ctx, 800, 0.15, 'sine', now + 0.1);
            this.playTone(ctx, 1000, 0.15, 'sine', now + 0.2);
            break;
          case 'powerup':
            for (let i = 0; i < 5; i++) {
              this.playTone(ctx, 400 + i * 100, 0.08, 'square', now + i * 0.05);
            }
            break;
          case 'hit':
            this.playNoise(ctx, 0.2, now);
            this.playTone(ctx, 150, 0.3, 'sawtooth', now);
            break;
          case 'clear':
            [523, 659, 784, 1047].forEach((f, i) => this.playTone(ctx, f, 0.2, 'square', now + i * 0.15));
            break;
          case 'gameover':
            this.playTone(ctx, 400, 0.3, 'sawtooth', now);
            this.playTone(ctx, 300, 0.3, 'sawtooth', now + 0.3);
            this.playTone(ctx, 200, 0.5, 'sawtooth', now + 0.6);
            break;
          case 'victory':
            [523, 659, 784, 659, 784, 1047].forEach((f, i) => this.playTone(ctx, f, 0.2, 'square', now + i * 0.12));
            break;
        }
      },

      playTone: function(ctx, freq, duration, type, startTime, endFreq = null) {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, startTime);
        if (endFreq) osc.frequency.linearRampToValueAtTime(endFreq, startTime + duration);
        gain.gain.setValueAtTime(0.3, startTime);
        gain.gain.exponentialRampToValueAtTime(0.01, startTime + duration);
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.start(startTime);
        osc.stop(startTime + duration);
      },

      playNoise: function(ctx, duration, startTime) {
        const bufferSize = ctx.sampleRate * duration;
        const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
        const data = buffer.getChannelData(0);
        for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
        const noise = ctx.createBufferSource();
        const gain = ctx.createGain();
        noise.buffer = buffer;
        gain.gain.setValueAtTime(0.3, startTime);
        gain.gain.exponentialRampToValueAtTime(0.01, startTime + duration);
        noise.connect(gain);
        gain.connect(ctx.destination);
        noise.start(startTime);
      },

      toggleBGM: function() {
        this.bgmEnabled = !this.bgmEnabled;
        this.bgmEnabled ? this.resumeBGM() : this.pauseBGM();
        return this.bgmEnabled;
      },

      toggleSE: function() {
        this.seEnabled = !this.seEnabled;
        return this.seEnabled;
      }
    };

    // ===== ÁîªÂÉèË™≠„ÅøËæº„ÅøÔºàÂ§âÊõ¥„Å™„ÅóÔºâ =====
    const images = {
      player: new Image(),
      enemies: { rabbit: new Image(), ghost: new Image(), bomb: new Image(), fire: new Image(), boss: new Image() }
    };
    images.player.src = 'image_0.png';
    images.enemies.rabbit.src = 'enemy8.png';
    images.enemies.ghost.src = 'image_1.png';
    images.enemies.bomb.src = 'enemy10.png';
    images.enemies.fire.src = 'image_3.png';
    images.enemies.boss.src = 'maou.png';
    
    const stageEnemyMapping = { 1:'rabbit', 2:'rabbit', 3:'ghost', 4:'ghost', 5:'bomb', 6:'bomb', 7:'fire', 8:'fire', 9:'fire', 10:'boss' };

    // ===== „Ç≤„Éº„É†Ë®≠ÂÆö =====
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const messageScreen = document.getElementById('messageScreen');
    const messageTitle = document.getElementById('messageTitle');
    const messageText = document.getElementById('messageText');
    const messageButton = document.getElementById('messageButton');
    const currentStageSpan = document.getElementById('currentStage');
    const currentLifeSpan = document.getElementById('currentLife');
    const currentScoreSpan = document.getElementById('currentScore');

    let gameState = 'menu';
    let currentStage = 1;
    let playerLife = 3;
    let score = 0;
    let animationId = null;
    const keys = { left: false, right: false, space: false };

    const player = { x: 50, y: 200, width: 40, height: 40, velocityX: 0, velocityY: 0, speed: 5, jumpPower: 12, onGround: false, invulnerable: false, invulnerableTime: 0, color: '#00ff00' };
    const gravity = 0.5;
    const maxFallSpeed = 10;
    let platforms = [], enemies = [], items = [], particles = [];
    let goal = { x: 750, y: 100, width: 30, height: 40 };
    let powerUps = { speedBoost: { active: false, timer: 0 }, highJump: { active: false, timer: 0 }, shield: { active: false, timer: 0 } };

    // ===== „Çπ„ÉÜ„Éº„Ç∏„Éá„Éº„ÇøÔºàÊõ¥Êñ∞ÁâàÔºö„Çπ„ÉÜ„Éº„Ç∏4Èõ£ÊòìÂ∫¶Ë™øÊï¥Ê∏à„ÅøÔºâ =====
    const stageData = [
      { name: "CYBER START", bgColor: "#001122", platforms: [{ x: 0, y: 550, width: 800, height: 50 },{ x: 100, y: 450, width: 100, height: 20 },{ x: 300, y: 350, width: 150, height: 20 },{ x: 500, y: 400, width: 100, height: 20 },{ x: 650, y: 300, width: 100, height: 20 }], enemies: [{ x: 350, y: 310, width: 40, height: 40, speed: 1, range: 100 }], items: [{ x: 150, y: 410, type: 'coin' },{ x: 375, y: 310, type: 'heart' },{ x: 550, y: 360, type: 'coin' }], goalY: 260 },
      { name: "NEON CITY", bgColor: "#0a0a2a", platforms: [{ x: 0, y: 550, width: 800, height: 50 },{ x: 80, y: 470, width: 80, height: 20 },{ x: 200, y: 400, width: 100, height: 20 },{ x: 350, y: 330, width: 80, height: 20 },{ x: 480, y: 280, width: 120, height: 20 },{ x: 650, y: 200, width: 100, height: 20 }], enemies: [{ x: 250, y: 360, width: 40, height: 40, speed: 1.5, range: 80 },{ x: 500, y: 240, width: 40, height: 40, speed: 1, range: 100 }], items: [{ x: 120, y: 430, type: 'coin' },{ x: 390, y: 290, type: 'speedBoost' },{ x: 530, y: 240, type: 'coin' }], goalY: 160 },
      { name: "DATA STREAM", bgColor: "#1a0a1a", platforms: [{ x: 0, y: 550, width: 800, height: 50 },{ x: 50, y: 480, width: 60, height: 20 },{ x: 150, y: 430, width: 80, height: 20 },{ x: 270, y: 380, width: 60, height: 20 },{ x: 370, y: 320, width: 100, height: 20 },{ x: 520, y: 270, width: 80, height: 20 },{ x: 650, y: 220, width: 100, height: 20 }], enemies: [{ x: 200, y: 390, width: 40, height: 40, speed: 2, range: 60 },{ x: 420, y: 280, width: 40, height: 40, speed: 1.5, range: 80 },{ x: 560, y: 230, width: 40, height: 40, speed: 1, range: 60 }], items: [{ x: 80, y: 440, type: 'coin' },{ x: 300, y: 340, type: 'highJump' },{ x: 420, y: 280, type: 'heart' },{ x: 690, y: 180, type: 'coin' }], goalY: 180 },
      
      // ‚òÖ„Åì„Åì„Åå‰øÆÊ≠£„Åó„Åü„Çπ„ÉÜ„Éº„Ç∏4„Åß„Åô
      { 
        name: "MATRIX ZONE", 
        bgColor: "#0a1a1a", 
        platforms: [
          { x: 0, y: 550, width: 800, height: 50 }, // Âú∞Èù¢
          { x: 50, y: 480, width: 100, height: 20 }, // 1ÊÆµÁõÆ(ÂÆâÂÖ®)
          { x: 200, y: 430, width: 80, height: 20, type: 'blinking', timer: 0 }, // 2ÊÆµÁõÆ(ÁÇπÊªÖ„ÉªÊïµ„Å™„Åó)
          { x: 350, y: 380, width: 150, height: 20 }, // 3ÊÆµÁõÆ(Â∫É„ÅÑ„ÉªÊïµ„ÅÇ„Çä)
          { x: 550, y: 330, width: 80, height: 20, type: 'blinking', timer: 150 }, // 4ÊÆµÁõÆ(ÁÇπÊªÖ„ÉªÊïµ„Å™„Åó)
          { x: 680, y: 250, width: 100, height: 20 } // „Ç¥„Éº„É´Ââç
        ], 
        enemies: [
          { x: 380, y: 340, width: 40, height: 40, speed: 1, range: 100 }, // 3ÊÆµÁõÆ„ÅÆÊïµ
          { x: 600, y: 510, width: 40, height: 40, speed: 2, range: 150 }  // ËêΩ„Å°„ÅüÊôÇÁî®„ÅÆÊïµ
        ], 
        items: [
          { x: 70, y: 440, type: 'coin' },
          { x: 400, y: 340, type: 'shield' }, 
          { x: 700, y: 210, type: 'heart' }
        ], 
        goalY: 210 
      },

      { name: "CYBER CORE", bgColor: "#2a0a2a", platforms: [{ x: 0, y: 550, width: 800, height: 50 },{ x: 80, y: 490, width: 100, height: 20, type: 'moving', vx: 2, minX: 50, maxX: 200 },{ x: 230, y: 430, width: 60, height: 20 },{ x: 340, y: 370, width: 100, height: 20, type: 'moving', vx: -2, minX: 300, maxX: 450 },{ x: 490, y: 310, width: 60, height: 20 },{ x: 600, y: 250, width: 100, height: 20, type: 'moving', vx: 1.5, minX: 550, maxX: 700 },{ x: 400, y: 480, width: 80, height: 20 }], enemies: [{ x: 130, y: 450, width: 40, height: 40, speed: 1, range: 80 },{ x: 260, y: 390, width: 40, height: 40, speed: 1.5, range: 40 },{ x: 390, y: 330, width: 40, height: 40, speed: 1.2, range: 80 },{ x: 520, y: 270, width: 40, height: 40, speed: 1, range: 40 },{ x: 650, y: 210, width: 40, height: 40, speed: 1.5, range: 80 }], items: [{ x: 130, y: 450, type: 'speedBoost' },{ x: 390, y: 330, type: 'heart' },{ x: 440, y: 440, type: 'coin' },{ x: 650, y: 210, type: 'shield' }], goalY: 210 },
      { name: "DIGITAL VOID", bgColor: "#1a1a2a", platforms: [{ x: 0, y: 550, width: 800, height: 50 },{ x: 60, y: 500, width: 60, height: 20, type: 'blinking', timer: 0 },{ x: 170, y: 460, width: 60, height: 20 },{ x: 280, y: 420, width: 60, height: 20, type: 'moving', vx: 1, minX: 250, maxX: 350 },{ x: 390, y: 380, width: 60, height: 20 },{ x: 500, y: 340, width: 60, height: 20, type: 'blinking', timer: 150 },{ x: 610, y: 300, width: 60, height: 20 },{ x: 720, y: 260, width: 60, height: 20 }], enemies: [{ x: 200, y: 420, width: 40, height: 40, speed: 1.5, range: 50 },{ x: 310, y: 380, width: 40, height: 40, speed: 1.5, range: 50 },{ x: 420, y: 340, width: 40, height: 40, speed: 1.5, range: 50 },{ x: 530, y: 300, width: 40, height: 40, speed: 1.5, range: 50 },{ x: 640, y: 260, width: 40, height: 40, speed: 1.5, range: 50 }], items: [{ x: 90, y: 460, type: 'coin' },{ x: 310, y: 380, type: 'highJump' },{ x: 530, y: 300, type: 'heart' },{ x: 750, y: 220, type: 'coin' }], goalY: 220 },
      { name: "NEON NEXUS", bgColor: "#2a1a0a", platforms: [{ x: 0, y: 550, width: 800, height: 50 },{ x: 100, y: 480, width: 50, height: 20 },{ x: 200, y: 420, width: 50, height: 20, type: 'moving', vx: 2, minX: 150, maxX: 250 },{ x: 300, y: 360, width: 50, height: 20 },{ x: 400, y: 300, width: 50, height: 20, type: 'blinking', timer: 0 },{ x: 500, y: 240, width: 50, height: 20 },{ x: 600, y: 180, width: 50, height: 20, type: 'moving', vx: -2, minX: 550, maxX: 650 },{ x: 700, y: 120, width: 80, height: 20 }], enemies: [{ x: 125, y: 440, width: 40, height: 40, speed: 1.6, range: 30 },{ x: 225, y: 380, width: 40, height: 40, speed: 1.7, range: 30 },{ x: 325, y: 320, width: 40, height: 40, speed: 1.5, range: 30 },{ x: 425, y: 260, width: 40, height: 40, speed: 3.5, range: 30 },{ x: 525, y: 200, width: 40, height: 40, speed: 1, range: 30 },{ x: 625, y: 140, width: 40, height: 40, speed: 1.5, range: 30 }], items: [{ x: 225, y: 380, type: 'speedBoost' },{ x: 425, y: 260, type: 'shield' },{ x: 625, y: 140, type: 'heart' },{ x: 740, y: 80, type: 'coin' }], goalY: 80 },
      { name: "QUANTUM LEAP", bgColor: "#0a2a2a", platforms: [{ x: 0, y: 550, width: 800, height: 50 },{ x: 80, y: 470, width: 40, height: 20, type: 'blinking', timer: 0 },{ x: 180, y: 390, width: 40, height: 20, type: 'blinking', timer: 150 },{ x: 280, y: 310, width: 40, height: 20, type: 'blinking', timer: 0 },{ x: 380, y: 230, width: 40, height: 20, type: 'blinking', timer: 150 },{ x: 480, y: 310, width: 40, height: 20 },{ x: 580, y: 390, width: 40, height: 20, type: 'moving', vx: 2, minX: 550, maxX: 650 },{ x: 680, y: 470, width: 40, height: 20 },{ x: 750, y: 150, width: 50, height: 20 }], enemies: [{ x: 100, y: 430, width: 40, height: 40, speed: 3.5, range: 20 },{ x: 200, y: 350, width: 40, height: 40, speed: 4, range: 20 },{ x: 300, y: 270, width: 40, height: 40, speed: 1.5, range: 20 },{ x: 400, y: 190, width: 40, height: 40, speed: 2, range: 20 },{ x: 500, y: 270, width: 40, height: 40, speed: 1.5, range: 20 },{ x: 600, y: 350, width: 40, height: 40, speed: 4, range: 20 },{ x: 700, y: 430, width: 40, height: 40, speed: 1.5, range: 20 }], items: [{ x: 200, y: 350, type: 'highJump' },{ x: 400, y: 190, type: 'speedBoost' },{ x: 600, y: 350, type: 'shield' },{ x: 775, y: 110, type: 'heart' }], goalY: 110 },
      { name: "CYBER STORM", bgColor: "#3a0a3a", platforms: [{ x: 0, y: 550, width: 800, height: 50 },{ x: 50, y: 500, width: 40, height: 20 },{ x: 130, y: 450, width: 40, height: 20, type: 'moving', vx: 1.5, minX: 100, maxX: 160 },{ x: 210, y: 400, width: 40, height: 20 },{ x: 290, y: 350, width: 40, height: 20, type: 'blinking', timer: 0 },{ x: 370, y: 300, width: 40, height: 20 },{ x: 450, y: 250, width: 40, height: 20, type: 'moving', vx: -1.5, minX: 420, maxX: 480 },{ x: 530, y: 200, width: 40, height: 20 },{ x: 610, y: 150, width: 40, height: 20, type: 'blinking', timer: 150 },{ x: 690, y: 100, width: 40, height: 20 },{ x: 760, y: 50, width: 40, height: 20 }], enemies: [{ x: 70, y: 460, width: 40, height: 40, speed: 1.4, range: 20 },{ x: 150, y: 410, width: 40, height: 40, speed: 1.5, range: 20 },{ x: 230, y: 360, width: 40, height: 40, speed: 2, range: 20 },{ x: 310, y: 310, width: 40, height: 40, speed: 1.5, range: 20 },{ x: 390, y: 260, width: 40, height: 40, speed: 2, range: 20 },{ x: 470, y: 210, width: 40, height: 40, speed: 1.5, range: 20 },{ x: 550, y: 160, width: 40, height: 40, speed: 10, range: 20 },{ x: 630, y: 110, width: 40, height: 40, speed: 1.5, range: 20 }], items: [{ x: 230, y: 360, type: 'speedBoost' },{ x: 390, y: 260, type: 'highJump' },{ x: 550, y: 160, type: 'shield' },{ x: 780, y: 10, type: 'heart' }], goalY: 10 },
      { name: "FINAL CORE - È≠îÁéã„ÅÆÈñì", bgColor: "#4a0a4a", platforms: [{ x: 0, y: 550, width: 800, height: 50 },{ x: 60, y: 490, width: 50, height: 20 },{ x: 150, y: 430, width: 50, height: 20, type: 'moving', vx: 2, minX: 120, maxX: 180 },{ x: 250, y: 370, width: 50, height: 20 },{ x: 350, y: 310, width: 100, height: 20, type: 'blinking', timer: 0 },{ x: 500, y: 370, width: 50, height: 20, type: 'blinking', timer: 150 },{ x: 600, y: 430, width: 50, height: 20, type: 'moving', vx: -2, minX: 570, maxX: 630 },{ x: 700, y: 490, width: 50, height: 20 },{ x: 350, y: 180, width: 100, height: 20 }], enemies: [{ x: 360, y: 100, width: 80, height: 80, speed: 1, range: 60, isBoss: true }], items: [{ x: 100, y: 450, type: 'heart' },{ x: 275, y: 330, type: 'shield' },{ x: 400, y: 270, type: 'speedBoost' },{ x: 525, y: 330, type: 'highJump' },{ x: 650, y: 390, type: 'heart' }], goalY: 140 }
    ];

    function loadStage(stageIndex) {
      const stage = stageData[stageIndex - 1];
      // Â∫ä„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÔºàÁä∂ÊÖã„É™„Çª„ÉÉ„Éà„ÅÆ„Åü„ÇÅ„Å´„Ç≥„Éî„ÉºÔºâ
      platforms = stage.platforms.map(p => ({ 
        ...p, 
        visible: true, 
        timer: p.timer || 0 
      }));
      enemies = stage.enemies.map(e => ({ ...e, startX: e.x, direction: 1, enemyType: stageIndex === 9 ? ['rabbit','ghost','bomb','fire'][Math.floor(Math.random()*4)] : stageEnemyMapping[stageIndex] }));
      items = stage.items.map(item => ({ ...item, width: 20, height: 20, collected: false }));
      goal.y = stage.goalY;
      canvas.style.background = `linear-gradient(to bottom, ${stage.bgColor}, #000)`;
      AudioSystem.playBGM(stageIndex === 10);
    }

    function init() { setupEventListeners(); updateUI(); }

    function setupEventListeners() {
      document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') keys.left = true;
        if (e.key === 'ArrowRight') keys.right = true;
        if (e.key === ' ' || e.key === 'ArrowUp') { keys.space = true; e.preventDefault(); }
      });
      document.addEventListener('keyup', (e) => {
        if (e.key === 'ArrowLeft') keys.left = false;
        if (e.key === 'ArrowRight') keys.right = false;
        if (e.key === ' ' || e.key === 'ArrowUp') keys.space = false;
      });

      // „É¢„Éê„Ç§„É´„Ç≥„É≥„Éà„É≠„Éº„É´ÔºàiOSÂØæÂøúÔºâ
      const leftBtn = document.getElementById('leftBtn');
      const rightBtn = document.getElementById('rightBtn');
      const jumpBtn = document.getElementById('jumpBtn');

      [leftBtn, rightBtn, jumpBtn].forEach(btn => {
        if (!btn) return;
        const key = btn.id === 'leftBtn' ? 'left' : btn.id === 'rightBtn' ? 'right' : 'space';
        btn.addEventListener('touchstart', (e) => { e.preventDefault(); keys[key] = true; }, { passive: false });
        btn.addEventListener('touchend', (e) => { e.preventDefault(); keys[key] = false; }, { passive: false });
        btn.addEventListener('touchcancel', () => keys[key] = false);
        btn.addEventListener('mousedown', () => keys[key] = true);
        btn.addEventListener('mouseup', () => keys[key] = false);
        btn.addEventListener('mouseleave', () => keys[key] = false);
      });

      // „Çµ„Ç¶„É≥„Éâ„Ç≥„É≥„Éà„É≠„Éº„É´
      document.getElementById('bgmToggle').addEventListener('click', function() {
        const enabled = AudioSystem.toggleBGM();
        this.classList.toggle('muted', !enabled);
        this.textContent = enabled ? 'üéµ' : 'üîá';
      });
      document.getElementById('seToggle').addEventListener('click', function() {
        const enabled = AudioSystem.toggleSE();
        this.classList.toggle('muted', !enabled);
        this.textContent = enabled ? 'üîä' : 'üîà';
      });

      messageButton.addEventListener('click', handleMessageButton);
    }

    function handleMessageButton() {
      AudioSystem.init();
      if (gameState === 'menu') startGame();
      else if (gameState === 'stageClear') nextStage();
      else if (gameState === 'gameOver' || gameState === 'gameComplete') resetGame();
    }

    function startGame() {
      // ‚òÖ„Åì„Åì„ÇíËøΩÂä†ÔºöÂâç„ÅÆ„É´„Éº„Éó„ÅåÊÆã„Å£„Å¶„ÅÑ„Åü„ÇâÂº∑Âà∂ÂÅúÊ≠¢„Åô„Çã
      if (animationId) cancelAnimationFrame(animationId);

      gameState = 'playing';
      currentStage = 1;
      playerLife = 3;
      score = 0;
      resetPlayer();
      loadStage(currentStage);
      hideMessage();
      updateUI();
      gameLoop();
    }function nextStage() { currentStage++; if (currentStage > 10) { gameComplete(); } else { gameState = 'playing'; resetPlayer(); loadStage(currentStage); hideMessage(); updateUI(); } }
    function resetGame() { gameState = 'menu'; currentStage = 1; playerLife = 3; score = 0; resetPlayer(); AudioSystem.stopBGM(); showMessage('CYBER CITY ADVENTURE', '„Çµ„Ç§„Éê„Éº„Éë„É≥„ÇØ„ÅÆ‰∏ñÁïå„ÇíÂÜíÈô∫„Åó„Çà„ÅÜÔºÅ<br>10„Çπ„ÉÜ„Éº„Ç∏ÂÖ®„ÇØ„É™„Ç¢„ÇíÁõÆÊåá„ÅõÔºÅ', 'START GAME'); updateUI(); }
    function resetPlayer() { player.x = 50; player.y = 200; player.velocityX = 0; player.velocityY = 0; player.onGround = false; player.invulnerable = false; player.invulnerableTime = 0; powerUps = { speedBoost: { active: false, timer: 0 }, highJump: { active: false, timer: 0 }, shield: { active: false, timer: 0 } }; }
    function updateUI() { currentStageSpan.textContent = currentStage; currentLifeSpan.textContent = playerLife; currentScoreSpan.textContent = score; }
    function showMessage(title, text, button) { messageTitle.textContent = title; messageText.innerHTML = text; messageButton.textContent = button; messageScreen.style.display = 'flex'; }
    function hideMessage() { messageScreen.style.display = 'none'; }
    function checkCollision(r1, r2) { return r1.x < r2.x + r2.width && r1.x + r1.width > r2.x && r1.y < r2.y + r2.height && r1.y + r1.height > r2.y; }

    // ===== Â∫ä„ÅÆÊõ¥Êñ∞Âá¶ÁêÜÔºàÊñ∞Ë¶èËøΩÂä†Ôºâ =====
    function updatePlatforms() {
      platforms.forEach(p => {
        // Âãï„ÅèÂ∫ä
        if (p.type === 'moving') {
          p.x += p.vx;
          if (p.x < p.minX || p.x > p.maxX) {
            p.vx *= -1;
          }
        }
        // ÁÇπÊªÖÂ∫ä (300„Éï„É¨„Éº„É† = Á¥Ñ5Áßí)
        if (p.type === 'blinking') {
          p.timer++;
          // 0-299: Ë°®Á§∫, 300-599: ÈùûË°®Á§∫
          if (p.timer >= 600) p.timer = 0;
          p.visible = p.timer < 300;
        }
      });
    }

    function updatePlayer() {
      let currentSpeed = powerUps.speedBoost.active ? player.speed * 1.5 : player.speed;
      if (keys.left) player.velocityX = -currentSpeed;
      else if (keys.right) player.velocityX = currentSpeed;
      else player.velocityX *= 0.8;

      let currentJumpPower = powerUps.highJump.active ? player.jumpPower * 1.3 : player.jumpPower;
      if (keys.space && player.onGround) { player.velocityY = -currentJumpPower; player.onGround = false; AudioSystem.playSE('jump'); }

      player.velocityY += gravity;
      if (player.velocityY > maxFallSpeed) player.velocityY = maxFallSpeed;
      player.x += player.velocityX;
      player.y += player.velocityY;
      if (player.x < 0) player.x = 0;
      if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
      if (player.y > canvas.height) loseLife();
      if (player.invulnerable) { player.invulnerableTime--; if (player.invulnerableTime <= 0) player.invulnerable = false; }
      Object.keys(powerUps).forEach(key => { if (powerUps[key].active) { powerUps[key].timer--; if (powerUps[key].timer <= 0) powerUps[key].active = false; } });
      
      // Â∫ä„Å®„ÅÆÂà§ÂÆö
      player.onGround = false;
      platforms.forEach(platform => {
        // Ê∂à„Åà„Å¶„ÅÑ„ÇãÂ∫ä„Å´„ÅØ‰πó„Çå„Å™„ÅÑ
        if (platform.type === 'blinking' && !platform.visible) return;

        if (checkCollision(player, platform) && player.velocityY > 0 && player.y < platform.y) { 
          player.y = platform.y - player.height; 
          player.velocityY = 0; 
          player.onGround = true; 

          // Âãï„ÅèÂ∫ä„Å´‰πó„Å£„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÄÅ‰∏ÄÁ∑í„Å´Âãï„Åè
          if (platform.type === 'moving') {
            player.x += platform.vx;
          }
        } 
      });
    }

    function updateEnemies() { enemies.forEach(enemy => { enemy.x += enemy.speed * enemy.direction; if (Math.abs(enemy.x - enemy.startX) > enemy.range) enemy.direction *= -1; if (!player.invulnerable && !powerUps.shield.active && checkCollision(player, enemy)) loseLife(); }); }

    function updateItems() { items = items.filter(item => { if (!item.collected && checkCollision(player, item)) { collectItem(item); return false; } return !item.collected; }); }

    function collectItem(item) {
      switch(item.type) {
        case 'coin': score += 100; createParticles(item.x + 10, item.y + 10, '#ffd700'); AudioSystem.playSE('coin'); break;
        case 'heart': if (playerLife < 5) playerLife++; score += 50; createParticles(item.x + 10, item.y + 10, '#ff69b4'); AudioSystem.playSE('heart'); break;
        case 'speedBoost': powerUps.speedBoost = { active: true, timer: 300 }; createParticles(item.x + 10, item.y + 10, '#00ffff'); AudioSystem.playSE('powerup'); break;
        case 'highJump': powerUps.highJump = { active: true, timer: 300 }; createParticles(item.x + 10, item.y + 10, '#ff00ff'); AudioSystem.playSE('powerup'); break;
        case 'shield': powerUps.shield = { active: true, timer: 300 }; createParticles(item.x + 10, item.y + 10, '#ffff00'); AudioSystem.playSE('powerup'); break;
      }
      updateUI();
    }

    function loseLife() {
      if (player.invulnerable || powerUps.shield.active) return;
      playerLife--; updateUI(); AudioSystem.playSE('hit');
      if (playerLife <= 0) gameOver();
      else { player.invulnerable = true; player.invulnerableTime = 120; resetPlayer(); loadStage(currentStage); createParticles(player.x + player.width/2, player.y + player.height/2, '#ff0000'); }
    }

    function checkGoal() { if (checkCollision(player, goal)) stageClear(); }
    function stageClear() { gameState = 'stageClear'; score += 500; updateUI(); AudioSystem.stopBGM(); AudioSystem.playSE('clear'); showMessage(`STAGE ${currentStage} CLEAR!`, `„Çπ„Ç≥„Ç¢: ${score}<br>ÊÆã„Çä„É©„Ç§„Éï: ${playerLife}`, 'NEXT STAGE'); }
    function gameOver() { gameState = 'gameOver'; AudioSystem.stopBGM(); AudioSystem.playSE('gameover'); showMessage('GAME OVER', `ÊúÄÁµÇ„Çπ„Ç≥„Ç¢: ${score}<br>Âà∞ÈÅî„Çπ„ÉÜ„Éº„Ç∏: ${currentStage}`, 'RETRY'); }
    function gameComplete() { gameState = 'gameComplete'; score += 1000; updateUI(); AudioSystem.stopBGM(); AudioSystem.playSE('victory'); showMessage('CONGRATULATIONS!', `ÂÖ®„Çπ„ÉÜ„Éº„Ç∏„ÇØ„É™„Ç¢ÔºÅ<br>ÊúÄÁµÇ„Çπ„Ç≥„Ç¢: ${score}`, 'PLAY AGAIN'); }

    function createParticles(x, y, color) { for (let i = 0; i < 8; i++) particles.push({ x, y, vx: (Math.random() - 0.5) * 5, vy: (Math.random() - 0.5) * 5, life: 30, color }); }
    function updateParticles() { particles = particles.filter(p => { p.x += p.vx; p.y += p.vy; p.vy += 0.2; p.life--; return p.life > 0; }); }

    function draw() {
      ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // --- Â∫äÊèèÁîªÔºà„É≠„Ç∏„ÉÉ„ÇØÂ§âÊõ¥Ôºâ ---
      platforms.forEach(p => {
        // Ê∂à„Åà„Å¶„ÅÑ„ÇãÂ∫ä„ÅØÊèèÁîª„Åó„Å™„ÅÑÔºà„Éá„Éê„ÉÉ„Ç∞Áî®„Å´Ê•µËñÑ„ÅèÊû†„Å†„ÅëÊÆã„Åô„Åì„Å®„ÇÇÂèØËÉΩ„Å†„Åå„ÄÅ‰ªäÂõû„ÅØÂÆåÂÖ®Ê∂àÂéªÔºâ
        if (p.type === 'blinking' && !p.visible) return;

        // Ëâ≤„ÅÆÊ±∫ÂÆö
        if (p.type === 'moving') {
           ctx.fillStyle = '#ff00ff'; // Âãï„ÅèÂ∫ä: „Éû„Çº„É≥„Çø
           ctx.strokeStyle = '#ff88ff';
        } else if (p.type === 'blinking') {
           // Ê∂à„Åà„ÇãÁõ¥Ââç(ÊÆã„Çä1Áßí=60„Éï„É¨„Éº„É†Êú™Ê∫Ä)„ÅØ„ÉÅ„Ç´„ÉÅ„Ç´„Åï„Åõ„Çã
           const timeLeft = 300 - p.timer;
           if (timeLeft < 60 && Math.floor(Date.now() / 50) % 2 === 0) {
             ctx.fillStyle = 'rgba(0, 255, 136, 0.3)';
           } else {
             ctx.fillStyle = '#00ff88'; 
           }
           ctx.strokeStyle = '#00ffaa';
        } else {
           ctx.fillStyle = '#00ff88'; // ÈÄöÂ∏∏Â∫ä: Á∑ë
           ctx.strokeStyle = '#00ffaa';
        }
        
        ctx.fillRect(p.x, p.y, p.width, p.height);
        ctx.lineWidth = 2;
        ctx.strokeRect(p.x, p.y, p.width, p.height);
      });

      items.forEach(item => {
        if (item.collected) return;
        switch(item.type) {
          case 'coin': ctx.fillStyle = '#ffd700'; ctx.beginPath(); ctx.arc(item.x + 10, item.y + 10, 8, 0, Math.PI * 2); ctx.fill(); break;
          case 'heart': ctx.fillStyle = '#ff69b4'; ctx.fillRect(item.x, item.y, 20, 20); break;
          case 'speedBoost': ctx.fillStyle = '#00ffff'; ctx.fillRect(item.x + 5, item.y, 10, 20); ctx.fillRect(item.x, item.y + 7, 20, 6); break;
          case 'highJump': ctx.fillStyle = '#ff00ff'; ctx.beginPath(); ctx.moveTo(item.x + 10, item.y); ctx.lineTo(item.x + 20, item.y + 20); ctx.lineTo(item.x, item.y + 20); ctx.closePath(); ctx.fill(); break;
          case 'shield': ctx.fillStyle = '#ffff00'; ctx.beginPath(); ctx.arc(item.x + 10, item.y + 10, 10, 0, Math.PI * 2); ctx.fill(); ctx.strokeStyle = '#ffff00'; ctx.lineWidth = 2; ctx.stroke(); break;
        }
      });

      enemies.forEach(enemy => {
        const img = images.enemies[enemy.enemyType || stageEnemyMapping[currentStage]];
        if (img && img.complete && img.naturalWidth > 0) ctx.drawImage(img, enemy.x, enemy.y, enemy.width, enemy.height);
        else { ctx.fillStyle = enemy.isBoss ? '#800080' : '#ff4444'; ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height); ctx.fillStyle = '#fff'; ctx.fillRect(enemy.x + enemy.width * 0.15, enemy.y + enemy.height * 0.2, enemy.width * 0.2, enemy.width * 0.15); ctx.fillRect(enemy.x + enemy.width * 0.65, enemy.y + enemy.height * 0.2, enemy.width * 0.2, enemy.width * 0.15); }
      });

      ctx.fillStyle = '#ffff00'; ctx.fillRect(goal.x, goal.y, goal.width, goal.height); ctx.strokeStyle = '#fff'; ctx.lineWidth = 3; ctx.strokeRect(goal.x, goal.y, goal.width, goal.height); ctx.fillStyle = '#fff'; ctx.font = '20px Arial'; ctx.fillText('‚òÖ', goal.x + 5, goal.y + 28);

      if (!player.invulnerable || Math.floor(player.invulnerableTime / 5) % 2 === 0) {
        if (images.player.complete && images.player.naturalWidth > 0) ctx.drawImage(images.player, player.x, player.y, player.width, player.height);
        else { ctx.fillStyle = player.color; ctx.fillRect(player.x, player.y, player.width, player.height); }
        if (powerUps.shield.active) { ctx.strokeStyle = 'rgba(255, 255, 0, 0.5)'; ctx.lineWidth = 3; ctx.beginPath(); ctx.arc(player.x + player.width/2, player.y + player.height/2, 25, 0, Math.PI * 2); ctx.stroke(); }
      }

      particles.forEach(p => { ctx.globalAlpha = p.life / 30; ctx.fillStyle = p.color; ctx.fillRect(p.x - 2, p.y - 2, 4, 4); });
      ctx.globalAlpha = 1;

      let hudY = 70; ctx.font = '12px Orbitron';
      if (powerUps.speedBoost.active) { ctx.fillStyle = '#00ffff'; ctx.fillText(`SPEED: ${Math.ceil(powerUps.speedBoost.timer / 60)}s`, 10, hudY); hudY += 20; }
      if (powerUps.highJump.active) { ctx.fillStyle = '#ff00ff'; ctx.fillText(`JUMP: ${Math.ceil(powerUps.highJump.timer / 60)}s`, 10, hudY); hudY += 20; }
      if (powerUps.shield.active) { ctx.fillStyle = '#ffff00'; ctx.fillText(`SHIELD: ${Math.ceil(powerUps.shield.timer / 60)}s`, 10, hudY); }
      ctx.fillStyle = 'rgba(255, 255, 255, 0.5)'; ctx.font = '10px Orbitron'; ctx.fillText(stageData[currentStage - 1].name, canvas.width - 150, 70);
    }

    function gameLoop() { 
      if (gameState === 'playing') { 
        updatePlatforms(); // Â∫ä„ÅÆÂãï„Åç„ÇíÊõ¥Êñ∞
        updatePlayer(); 
        updateEnemies(); 
        updateItems(); 
        updateParticles(); 
        checkGoal(); 
        draw(); 
      } 
      animationId = requestAnimationFrame(gameLoop); 
    }

    init();
  </script>
</body>
</html>
